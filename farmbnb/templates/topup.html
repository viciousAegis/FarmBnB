<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Top-up</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
    <style>
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }

        .payment-option {
            margin-bottom: 20px;
        }

        .payment-form {
            display: none; 
        }

        .payment-form.active {
            display: block; 
        }

        label {
            display: block;
            margin-bottom: 10px;
        }

        input[type="text"],
        input[type="number"] {
            width: 100%;
            padding: 8px;
            margin-bottom: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }

        input[type="submit"] {
            padding: 10px 20px;
            background-color: #007bff;
            color: #fff;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        input[type="submit"]:hover {
            background-color: #0056b3;
        }
    </style>
</head>

<body onLoad="check()">
    <div class="logo-small">
        <img src="{{ url_for('static', filename='images/farmbnb_logo.png') }}" alt="FarmBnB Logo">
    </div>
    <nav class="navbar">
        <ul class="navbar-nav">
            <li class="nav-item"><a href="/farms">Farms</a></li>
            <li class="nav-item"><a href="/subscriptions">Subscriptions</a></li>
            <li class="nav-item"><a href="/bookings">Bookings</a></li>
            <li class="nav-item"><a href="/profile">Profile</a></li>
        </ul>
    </nav><br><br>

    <header class="header">
        <h1>Insufficient Balance</h1>
        </header>

    <div class="container">
        <div class="payment-option">
            <input type="radio" name="payment-method" id="upi" value="upi" checked>
            <label for="upi">Pay using UPI</label>
            <input type="radio" name="payment-method" id="credit-card" value="credit-card">
            <label for="credit-card">Pay using Credit Card</label>
        </div>

        <form id="upi-form" class="payment-form active">
            <label for="upi-id">Enter UPI ID:</label>
            <input type="text" id="upi-id" name="upi-id" placeholder="Your UPI ID">
            <label for="amount">Topup amount:</label>
            <input type="number" id="amount" name="amount" placeholder="5000">
            <input type="submit" value="Submit">
        </form>

        <form id="credit-card-form" class="payment-form">
            <label for="name">Name on card:</label>
            <input type="text" id="name" name="name" placeholder="John Doe">
            <label for="card-number">Card Number:</label>
            <input type="text" id="card-number" name="card-number" placeholder="1234 5678 9012 3456">
            <label for="cvv">CVV:</label>
            <input type="number" id="cvv" name="cvv" placeholder="123">
            <label for="amount">Topup amount:</label>
            <input type="number" id="amount" name="amount" placeholder="5000">
            <input type="submit" value="Submit">
        </form>
    </div>

    <script>
        const upiForm = document.getElementById('upi-form');
        const creditCardForm = document.getElementById('credit-card-form');
        const upiRadio = document.getElementById('upi');
        const creditCardRadio = document.getElementById('credit-card');
        const userId = localStorage.getItem('user');
        const submitButton = document.querySelector('input[type="submit"]');

        upiRadio.addEventListener('change', () => {
            upiForm.classList.add('active');
            creditCardForm.classList.remove('active');
        });

        creditCardRadio.addEventListener('change', () => {
            upiForm.classList.remove('active');
            creditCardForm.classList.add('active');
        });

        function check() {
            const userId = localStorage.getItem('user');
            if (!userId) {
                window.location.href = '/';
            }
        }

        submitButton.addEventListener('click', (event) => {
            event.preventDefault();
            const upiId = document.getElementById('upi-id').value;
            const cardNumber = document.getElementById('card-number').value;
            const cvv = document.getElementById('cvv').value;
            const amount = document.getElementById('amount').value;
            const urlParams = new URLSearchParams(window.location.search);
            const userId = localStorage.getItem('user');
            const totalPrice = urlParams.get('totalPrice');
            var payment_method = '';
            if(upiForm.classList.contains('active')) {
                payment_method = 'upi';
            } else {
                payment_method = 'credit-card';
            }

                fetch('http://localhost:5002/pay/book', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        user_id: userId,
                        payment_info: upiId,
                        total_price: totalPrice,
                        payment_method: payment_method,
                        amount: amount
                    })
                })
                .then(response => {
                    if (response.ok) {
                        alert('Topup successful! Booked farm successfully!');
                        window.location.href = '/bookings';
                    } else {
                        response.json().then(data => {
                            alert('Error: ' + data.message);
                        });
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('Error: ' + error.message);
                });
        });

    </script>
</body>

</html>
